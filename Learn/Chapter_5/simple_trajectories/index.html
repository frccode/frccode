<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href=https://frccode.github.io/Learn/Chapter_5/simple_trajectories/ rel=canonical><link href=../drive_bases/ rel=prev><link href=../swerve_control/ rel=next><link rel=icon href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.14"><title>Swerve Trajectory: Getting Started - FRCCode.org</title><link rel=stylesheet href=../../../assets/stylesheets/main.342714a4.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/material.min.css><link rel=stylesheet href=../../../css/pid-simulator.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=blue data-md-color-accent=cyan> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#swerve-trajectory-getting-started class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../.. title=FRCCode.org class="md-header__button md-logo" aria-label=FRCCode.org data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> FRCCode.org </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Swerve Trajectory: Getting Started </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/frccode/frccode title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> frccode/frccode </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> FRCCode </a> </li> <li class=md-tabs__item> <a href=../../../support_and_help/ class=md-tabs__link> Support &amp; Help </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../Chapter_0/java_intro/ class=md-tabs__link> Learn </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title=FRCCode.org class="md-nav__button md-logo" aria-label=FRCCode.org data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> FRCCode.org </label> <div class=md-nav__source> <a href=https://github.com/frccode/frccode title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> frccode/frccode </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> <span class=md-ellipsis> FRCCode </span> </a> </li> <li class=md-nav__item> <a href=../../../support_and_help/ class=md-nav__link> <span class=md-ellipsis> Support &amp; Help </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> Learn </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Learn </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_1> <label class=md-nav__link for=__nav_3_1 id=__nav_3_1_label tabindex> <span class=md-ellipsis> Chapter 0 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_1_label aria-expanded=false> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> Chapter 0 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Chapter_0/java_intro/ class=md-nav__link> <span class=md-ellipsis> Introduction to Java in FRC Programming </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_2> <label class=md-nav__link for=__nav_3_2 id=__nav_3_2_label tabindex> <span class=md-ellipsis> Chapter 1 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> Chapter 1 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Chapter_1/1_prerequisites_intro/ class=md-nav__link> <span class=md-ellipsis> Prerequisites of FRC Programming </span> </a> </li> <li class=md-nav__item> <a href=../../Chapter_1/2_wpilib/ class=md-nav__link> <span class=md-ellipsis> WPIlib and Associated Tools </span> </a> </li> <li class=md-nav__item> <a href=../../Chapter_1/4_Version_Control_intro/ class=md-nav__link> <span class=md-ellipsis> Version Control Guide for FRC Teams </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_3> <label class=md-nav__link for=__nav_3_3 id=__nav_3_3_label tabindex> <span class=md-ellipsis> Chapter 2 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> Chapter 2 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Chapter_2/simple_robot_programming/ class=md-nav__link> <span class=md-ellipsis> An Intro Through Timed Robot </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_4> <label class=md-nav__link for=__nav_3_4 id=__nav_3_4_label tabindex> <span class=md-ellipsis> Chapter 3 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_4_label aria-expanded=false> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> Chapter 3 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Chapter_3/1_command_based_programming/ class=md-nav__link> <span class=md-ellipsis> Command-Based Robot Programming Guide </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_5> <label class=md-nav__link for=__nav_3_5 id=__nav_3_5_label tabindex> <span class=md-ellipsis> Chapter 4 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_5_label aria-expanded=false> <label class=md-nav__title for=__nav_3_5> <span class="md-nav__icon md-icon"></span> Chapter 4 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Chapter_4/PID/ class=md-nav__link> <span class=md-ellipsis> PID Control </span> </a> </li> <li class=md-nav__item> <a href=../../Chapter_4/simple_profiling/ class=md-nav__link> <span class=md-ellipsis> Motion Profiling: Getting Started </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_6 checked> <label class=md-nav__link for=__nav_3_6 id=__nav_3_6_label tabindex> <span class=md-ellipsis> Chapter 5 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_6_label aria-expanded=true> <label class=md-nav__title for=__nav_3_6> <span class="md-nav__icon md-icon"></span> Chapter 5 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../differential_control/ class=md-nav__link> <span class=md-ellipsis> Differential (Tank) Drive Programming Guide </span> </a> </li> <li class=md-nav__item> <a href=../drive_bases/ class=md-nav__link> <span class=md-ellipsis> Drive Base in FRC Programming </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Swerve Trajectory: Getting Started </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Swerve Trajectory: Getting Started </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#overview class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=#1-why-swerve-trajectories class=md-nav__link> <span class=md-ellipsis> 1. Why Swerve Trajectories? </span> </a> <nav class=md-nav aria-label="1. Why Swerve Trajectories?"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#the-problem-with-basic-movement class=md-nav__link> <span class=md-ellipsis> The Problem with Basic Movement </span> </a> </li> <li class=md-nav__item> <a href=#swerve-trajectory-solution class=md-nav__link> <span class=md-ellipsis> Swerve Trajectory Solution </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2-understanding-swerve-trajectories class=md-nav__link> <span class=md-ellipsis> 2. Understanding Swerve Trajectories </span> </a> <nav class=md-nav aria-label="2. Understanding Swerve Trajectories"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#key-distinctions class=md-nav__link> <span class=md-ellipsis> Key Distinctions </span> </a> </li> <li class=md-nav__item> <a href=#components-of-a-swerve-trajectory class=md-nav__link> <span class=md-ellipsis> Components of a Swerve Trajectory </span> </a> </li> <li class=md-nav__item> <a href=#path-constraints class=md-nav__link> <span class=md-ellipsis> Path Constraints </span> </a> </li> <li class=md-nav__item> <a href=#holomonic-controller class=md-nav__link> <span class=md-ellipsis> Holomonic Controller </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#3-basic-implementation class=md-nav__link> <span class=md-ellipsis> 3. Basic Implementation </span> </a> <nav class=md-nav aria-label="3. Basic Implementation"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#create-your-first-trajectory class=md-nav__link> <span class=md-ellipsis> Create Your First Trajectory </span> </a> </li> <li class=md-nav__item> <a href=#define-your-holomonic-controller class=md-nav__link> <span class=md-ellipsis> Define your Holomonic Controller </span> </a> </li> <li class=md-nav__item> <a href=#populate-execute-initialize-isfinished class=md-nav__link> <span class=md-ellipsis> Populate Execute, Initialize, isFinished </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#5-creating-autos class=md-nav__link> <span class=md-ellipsis> 5. Creating Autos </span> </a> <nav class=md-nav aria-label="5. Creating Autos"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#creating-trajectories class=md-nav__link> <span class=md-ellipsis> Creating trajectories </span> </a> </li> <li class=md-nav__item> <a href=#optionalconstraints-for-different-sections class=md-nav__link> <span class=md-ellipsis> (Optional)Constraints for Different Sections </span> </a> </li> <li class=md-nav__item> <a href=#apply-it-to-a-drive-trajectory-command class=md-nav__link> <span class=md-ellipsis> Apply it to a Drive Trajectory Command </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#6-real-world-examples class=md-nav__link> <span class=md-ellipsis> 6. Real-World Examples </span> </a> <nav class=md-nav aria-label="6. Real-World Examples"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#simple-autonomous-routine class=md-nav__link> <span class=md-ellipsis> Simple Autonomous Routine </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#7-tuning-and-debugging class=md-nav__link> <span class=md-ellipsis> 7. Tuning and Debugging </span> </a> <nav class=md-nav aria-label="7. Tuning and Debugging"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#common-issues-solutions class=md-nav__link> <span class=md-ellipsis> Common Issues &amp; Solutions </span> </a> </li> <li class=md-nav__item> <a href=#pid-tuning-guidelines class=md-nav__link> <span class=md-ellipsis> PID Tuning Guidelines </span> </a> </li> <li class=md-nav__item> <a href=#success-criteria class=md-nav__link> <span class=md-ellipsis> Success Criteria: </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#8-advanced-techniques class=md-nav__link> <span class=md-ellipsis> 8. Advanced Techniques </span> </a> <nav class=md-nav aria-label="8. Advanced Techniques"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#dynamic-trajectory-generation class=md-nav__link> <span class=md-ellipsis> Dynamic Trajectory Generation </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#public-command-autotargetposeswervedrive-swerve-pose2d-target-create-new-trajectory-from-current-position-trajectory-dynamicpath-trajectorygeneratorgeneratetrajectory-swervegetpose-start-from-where-we-are-now-listof-target-go-to-new-target-config-start-following-immediately-return-new-trajectorycommandswerve-dynamicpath class=md-nav__link> <span class=md-ellipsis> public Command autoTargetPose(SwerveDrive swerve, Pose2d target) { // Create new trajectory from current position Trajectory dynamicPath = TrajectoryGenerator.generateTrajectory( swerve.getPose(), // Start from where we are now List.of(), target, // Go to new target config ); // Start following immediately return new TrajectoryCommand(swerve, dynamicPath) } </span> </a> </li> <li class=md-nav__item> <a href=#links-for-further-reference class=md-nav__link> <span class=md-ellipsis> Links for further reference </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../swerve_control/ class=md-nav__link> <span class=md-ellipsis> Swerve Drive Programming Guide </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_7> <label class=md-nav__link for=__nav_3_7 id=__nav_3_7_label tabindex> <span class=md-ellipsis> Chapter 6 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_7_label aria-expanded=false> <label class=md-nav__title for=__nav_3_7> <span class="md-nav__icon md-icon"></span> Chapter 6 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Chapter_6/auto_strategy/ class=md-nav__link> <span class=md-ellipsis> FRC Autonomous Programming - Strategy and Planning </span> </a> </li> <li class=md-nav__item> <a href=../../Chapter_6/extrainfoPuttingelsewhere/ class=md-nav__link> <span class=md-ellipsis> extrainfoPuttingelsewhere </span> </a> </li> <li class=md-nav__item> <a href=../../Chapter_6/writing_autos/ class=md-nav__link> <span class=md-ellipsis> FRC Autonomous Programming - Technical Implementation </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_8> <label class=md-nav__link for=__nav_3_8 id=__nav_3_8_label tabindex> <span class=md-ellipsis> Chapter 7 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_8_label aria-expanded=false> <label class=md-nav__title for=__nav_3_8> <span class="md-nav__icon md-icon"></span> Chapter 7 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Chapter_7/logging_intro/ class=md-nav__link> <span class=md-ellipsis> Logging intro </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_9> <label class=md-nav__link for=__nav_3_9 id=__nav_3_9_label tabindex> <span class=md-ellipsis> Chapter 8 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_9_label aria-expanded=false> <label class=md-nav__title for=__nav_3_9> <span class="md-nav__icon md-icon"></span> Chapter 8 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Chapter_8/apriltag_processing/ class=md-nav__link> <span class=md-ellipsis> AprilTag Processing: Getting Started </span> </a> </li> <li class=md-nav__item> <a href=../../Chapter_8/pose_estimators_and_kalman_filters/ class=md-nav__link> <span class=md-ellipsis> Kalman Filters &amp; Pose Estimation: Getting Started </span> </a> </li> <li class=md-nav__item> <a href=../../Chapter_8/vision_explanation/ class=md-nav__link> <span class=md-ellipsis> Vision Processing: Getting Started </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#overview class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=#1-why-swerve-trajectories class=md-nav__link> <span class=md-ellipsis> 1. Why Swerve Trajectories? </span> </a> <nav class=md-nav aria-label="1. Why Swerve Trajectories?"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#the-problem-with-basic-movement class=md-nav__link> <span class=md-ellipsis> The Problem with Basic Movement </span> </a> </li> <li class=md-nav__item> <a href=#swerve-trajectory-solution class=md-nav__link> <span class=md-ellipsis> Swerve Trajectory Solution </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2-understanding-swerve-trajectories class=md-nav__link> <span class=md-ellipsis> 2. Understanding Swerve Trajectories </span> </a> <nav class=md-nav aria-label="2. Understanding Swerve Trajectories"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#key-distinctions class=md-nav__link> <span class=md-ellipsis> Key Distinctions </span> </a> </li> <li class=md-nav__item> <a href=#components-of-a-swerve-trajectory class=md-nav__link> <span class=md-ellipsis> Components of a Swerve Trajectory </span> </a> </li> <li class=md-nav__item> <a href=#path-constraints class=md-nav__link> <span class=md-ellipsis> Path Constraints </span> </a> </li> <li class=md-nav__item> <a href=#holomonic-controller class=md-nav__link> <span class=md-ellipsis> Holomonic Controller </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#3-basic-implementation class=md-nav__link> <span class=md-ellipsis> 3. Basic Implementation </span> </a> <nav class=md-nav aria-label="3. Basic Implementation"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#create-your-first-trajectory class=md-nav__link> <span class=md-ellipsis> Create Your First Trajectory </span> </a> </li> <li class=md-nav__item> <a href=#define-your-holomonic-controller class=md-nav__link> <span class=md-ellipsis> Define your Holomonic Controller </span> </a> </li> <li class=md-nav__item> <a href=#populate-execute-initialize-isfinished class=md-nav__link> <span class=md-ellipsis> Populate Execute, Initialize, isFinished </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#5-creating-autos class=md-nav__link> <span class=md-ellipsis> 5. Creating Autos </span> </a> <nav class=md-nav aria-label="5. Creating Autos"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#creating-trajectories class=md-nav__link> <span class=md-ellipsis> Creating trajectories </span> </a> </li> <li class=md-nav__item> <a href=#optionalconstraints-for-different-sections class=md-nav__link> <span class=md-ellipsis> (Optional)Constraints for Different Sections </span> </a> </li> <li class=md-nav__item> <a href=#apply-it-to-a-drive-trajectory-command class=md-nav__link> <span class=md-ellipsis> Apply it to a Drive Trajectory Command </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#6-real-world-examples class=md-nav__link> <span class=md-ellipsis> 6. Real-World Examples </span> </a> <nav class=md-nav aria-label="6. Real-World Examples"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#simple-autonomous-routine class=md-nav__link> <span class=md-ellipsis> Simple Autonomous Routine </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#7-tuning-and-debugging class=md-nav__link> <span class=md-ellipsis> 7. Tuning and Debugging </span> </a> <nav class=md-nav aria-label="7. Tuning and Debugging"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#common-issues-solutions class=md-nav__link> <span class=md-ellipsis> Common Issues &amp; Solutions </span> </a> </li> <li class=md-nav__item> <a href=#pid-tuning-guidelines class=md-nav__link> <span class=md-ellipsis> PID Tuning Guidelines </span> </a> </li> <li class=md-nav__item> <a href=#success-criteria class=md-nav__link> <span class=md-ellipsis> Success Criteria: </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#8-advanced-techniques class=md-nav__link> <span class=md-ellipsis> 8. Advanced Techniques </span> </a> <nav class=md-nav aria-label="8. Advanced Techniques"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#dynamic-trajectory-generation class=md-nav__link> <span class=md-ellipsis> Dynamic Trajectory Generation </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#public-command-autotargetposeswervedrive-swerve-pose2d-target-create-new-trajectory-from-current-position-trajectory-dynamicpath-trajectorygeneratorgeneratetrajectory-swervegetpose-start-from-where-we-are-now-listof-target-go-to-new-target-config-start-following-immediately-return-new-trajectorycommandswerve-dynamicpath class=md-nav__link> <span class=md-ellipsis> public Command autoTargetPose(SwerveDrive swerve, Pose2d target) { // Create new trajectory from current position Trajectory dynamicPath = TrajectoryGenerator.generateTrajectory( swerve.getPose(), // Start from where we are now List.of(), target, // Go to new target config ); // Start following immediately return new TrajectoryCommand(swerve, dynamicPath) } </span> </a> </li> <li class=md-nav__item> <a href=#links-for-further-reference class=md-nav__link> <span class=md-ellipsis> Links for further reference </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=swerve-trajectory-getting-started>Swerve Trajectory: Getting Started<a class=headerlink href=#swerve-trajectory-getting-started title="Permanent link">&para;</a></h1> <h2 id=overview>Overview<a class=headerlink href=#overview title="Permanent link">&para;</a></h2> <p>Swerve trajectory combines the power of motion profiling with holonomic movement, letting your robot follow smooth, planned paths while rotating independently. Instead of jerky point-to-point movement, your robot will glide along curves with perfect timing and coordination.</p> <p>Jump to <a href=#3-basic-implementation>Basic Implementation</a> for a quick start. However it is highly recommended to read the sections 1-2 for a lower level understanding of trajectories.</p> <p><strong>What you'll build:</strong> A <strong>Swerve</strong> robot that smoothly follows pre-planned paths with independent rotation control. This will cover the underlying explanation behind trajectory planning and a simple implementation of trajectory planning and following from wpilib. </p> <hr> <h2 id=1-why-swerve-trajectories>1. Why Swerve Trajectories?<a class=headerlink href=#1-why-swerve-trajectories title="Permanent link">&para;</a></h2> <h3 id=the-problem-with-basic-movement>The Problem with Basic Movement<a class=headerlink href=#the-problem-with-basic-movement title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=c1>// Basic swerve: Get there somehow</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=k>new</span><span class=w> </span><span class=n>SequentialCommandGroup</span><span class=p>(</span>
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=w>    </span><span class=k>new</span><span class=w> </span><span class=n>InstantCommand</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>swerve</span><span class=p>.</span><span class=na>drive</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>ChassisSpeeds</span><span class=p>(</span><span class=mf>2.0</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>))),</span><span class=w> </span><span class=c1>// Move forward</span>
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=w>    </span><span class=k>new</span><span class=w> </span><span class=n>WaitCommand</span><span class=p>(</span><span class=mf>1.0</span><span class=p>),</span><span class=w> </span><span class=c1>// Wait for 1 second (adjust as needed)</span>
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=w>    </span><span class=k>new</span><span class=w> </span><span class=n>InstantCommand</span><span class=p>(()</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>swerve</span><span class=p>.</span><span class=na>drive</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>ChassisSpeeds</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mf>2.0</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>)))</span><span class=w> </span><span class=c1>// Move sideways</span>
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=p>)</span>
</code></pre></div> <p><strong>Issues:</strong> - Did not need to rely on vision -&gt; Teams primarily chose full wheel odometry to measure how far they travelled, which could potentially lead to measurment errors. - Can't avoid obstacles smoothly</p> <p>However, with tank drives being the primary choice of drive base, this method of striaght-line movements was the common autonomous method in games pre-2022.</p> <h3 id=swerve-trajectory-solution>Swerve Trajectory Solution<a class=headerlink href=#swerve-trajectory-solution title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=kd>public</span><span class=w> </span><span class=n>Command</span><span class=w> </span><span class=nf>trajectory</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=w>    </span><span class=n>PathPlannerPath</span><span class=w> </span><span class=n>path</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>getStraightLinePath</span><span class=p>(</span><span class=n>currentPose</span><span class=p>,</span><span class=w> </span><span class=n>goal</span><span class=p>,</span><span class=w> </span><span class=n>DriveConstants</span><span class=p>.</span><span class=na>PATHFINDING_CONSTRAINTS</span><span class=p>);</span><span class=w> </span>
<a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>TrajectoryDriveCmd</span><span class=p>(</span><span class=n>path</span><span class=p>,</span><span class=w> </span><span class=kc>true</span><span class=p>,</span><span class=w> </span><span class=kc>true</span><span class=p>).</span>
<a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=p>}</span>
<a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=c1>// Robot follows exact path with precise timing</span>
</code></pre></div> <p><strong>Benefits:</strong> - <strong>Predictable paths</strong> - Know exactly where robot will be - <strong>Smooth motion</strong> - Curved paths instead of sharp corners - <strong>Independent rotation</strong> - Face any direction while moving - <strong>Obstacle avoidance</strong> - Plan around field elements</p> <p>With the introduction of swerve drives and outside libraries such as Pathplanner and Choreo, the bar to acchiving trajectory has been lowered. More and more teams can take advantage of these tools to boost compeittion performance. </p> <blockquote> <p>However, it is crucial to understand what happens at a lower level with trajectory planning. Without understanding some lower level components, it's easy for teams to solve their trajectory issues with the wrong methods due to a lack of understanding. </p> </blockquote> <p><strong>Holonomic Advantage:</strong></p> <p>If you recall from <a href=../swerve_control/#control-definitions>Swerve Control: Control Definitions</a>, Holomonic Controllers, which include swerves operating on trajectory, will not require the robot to face in a specific direction to follow the path, easing time constraints and enabling more game specific actions. <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a>Traditional Robot:    Swerve Robot:
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>     ↑                   ↑ ← Robot can face any direction
<a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a>     |                   |   while following any path
<a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a>  [ROBOT]             [ROBOT]
<a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a>     |                   ↓
<a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a>     Path = Facing    Path ≠ Facing
</code></pre></div></p> <hr> <h2 id=2-understanding-swerve-trajectories>2. Understanding Swerve Trajectories<a class=headerlink href=#2-understanding-swerve-trajectories title="Permanent link">&para;</a></h2> <h3 id=key-distinctions>Key Distinctions<a class=headerlink href=#key-distinctions title="Permanent link">&para;</a></h3> <p>There is a key distinction to make between <strong>Trajectories</strong> and <strong>Paths</strong> - <strong>Path</strong> - The shape/route (like a road) - Used by Pathplanner and Choreo vendors display on gui.<br> - <strong>Trajectory</strong> - Path + timing (like a GPS route with arrival times)</p> <p><strong>Further Reading and Reference:</strong><br> <a href=https://bia.unibz.it/esploro/outputs/bookChapter/Path-Planning-and-Trajectory-Planning-Algorithms-a-General/991005772345001241>Path Planning and Trajectory Planning Algorithms: a General Overview</a>. </p> <h3 id=components-of-a-swerve-trajectory>Components of a Swerve Trajectory<a class=headerlink href=#components-of-a-swerve-trajectory title="Permanent link">&para;</a></h3> <p>Due to the slight differences in how Pathplanner and Choreo define a trajectory, we will be explaining the WPILIB definition of a trajectory.</p> <p><strong>Translation Trajectory:</strong> - X and Y velocity - X and Y acceleration - Goal Pose</p> <p><strong>Rotation Trajectory:</strong> - Angular velocity - Angular Accel - Heading</p> <p><strong>Combined Result:</strong> At any time <code>t</code>, the trajectory provides a full robot state at that singular moment. This is usually encapsulated within its own object called a <strong>state</strong> or <strong>sample</strong>. This can be then used as target information for our robot to follow in order to stay on the path the user provided. <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=c1>// At any time t, the trajectory provides:</span>
<a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=n>TrajectoryState</span><span class=w> </span><span class=n>state</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>trajectory</span><span class=p>.</span><span class=na>sample</span><span class=p>(</span><span class=n>t</span><span class=p>);</span>
<a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=c1>// state.poseMeters     - Where robot should be (x, y, rotation)</span>
<a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a><span class=c1>// state.velocityMPS    - How fast robot should move</span>
<a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a><span class=c1>// state.curvatureRPM   - Path curvature at this point</span>
</code></pre></div></p> <h3 id=path-constraints>Path Constraints<a class=headerlink href=#path-constraints title="Permanent link">&para;</a></h3> <p>Path constraints are rules that limit the robot's speed, acceleration, or other properties along specific sections or entire sections of a trajectory. They help give more control over what the drive base should do at a specific area. Similarly to before, there are slight implementation differences across trajectory libraries. WPILIB uses a code based approach shown below while Pathplanner and Chreo prefer to have them defined on their path GUI.</p> <p><strong>Common constraint types:</strong> - <strong>Max Velocity Constraint:</strong> Limits top speed in a region. - <strong>Max Acceleration Constraint:</strong> Restricts acceleration. - <strong>Centripetal Acceleration Constraint:</strong> Prevents excessive speed. - <strong>Region Constraint:</strong> Applies constraints only within a defined area. - <strong>Custom Constraints:</strong> WPILIB trajectory implementation specifcally allows users to implement their own logics that determines when velocity, acceleration, or region constraints should be applied.</p> <p>Path constraints can have 1 or more of these constraints combined into one. Here is a WPILIB example:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=n>TrajectoryConfig</span><span class=w> </span><span class=n>config</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>TrajectoryConfig</span><span class=p>(</span><span class=mf>2.0</span><span class=p>,</span><span class=w> </span><span class=mf>1.0</span><span class=p>);</span>
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a>
<a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=c1>// Slow down in the scoring zone (rectangle from (2,2) to (4,4))</span>
<a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=n>config</span><span class=p>.</span><span class=na>addConstraint</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>RectangularRegionConstraint</span><span class=p>(</span>
<a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=w>    </span><span class=k>new</span><span class=w> </span><span class=n>Translation2d</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>),</span><span class=w>           </span><span class=c1>// Bottom-left corner</span>
<a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a><span class=w>    </span><span class=k>new</span><span class=w> </span><span class=n>Translation2d</span><span class=p>(</span><span class=mi>4</span><span class=p>,</span><span class=w> </span><span class=mi>4</span><span class=p>),</span><span class=w>           </span><span class=c1>// Top-right corner</span>
<a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a><span class=w>    </span><span class=k>new</span><span class=w> </span><span class=n>MaxVelocityConstraint</span><span class=p>(</span><span class=mf>0.5</span><span class=p>)</span><span class=w>     </span><span class=c1>// Limit speed to 0.5 m/s in this region</span>
<a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a><span class=p>));</span>
<a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a>
<a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a><span class=c1>// Generate trajectory with constraints</span>
<a id=__codelineno-4-11 name=__codelineno-4-11 href=#__codelineno-4-11></a><span class=n>Trajectory</span><span class=w> </span><span class=n>trajectory</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>TrajectoryGenerator</span><span class=p>.</span><span class=na>generateTrajectory</span><span class=p>(</span>
<a id=__codelineno-4-12 name=__codelineno-4-12 href=#__codelineno-4-12></a><span class=w>    </span><span class=k>new</span><span class=w> </span><span class=n>Pose2d</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Rotation2d</span><span class=p>(</span><span class=mi>0</span><span class=p>)),</span>
<a id=__codelineno-4-13 name=__codelineno-4-13 href=#__codelineno-4-13></a><span class=w>    </span><span class=n>List</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>Translation2d</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span><span class=w> </span><span class=mi>3</span><span class=p>)),</span>
<a id=__codelineno-4-14 name=__codelineno-4-14 href=#__codelineno-4-14></a><span class=w>    </span><span class=k>new</span><span class=w> </span><span class=n>Pose2d</span><span class=p>(</span><span class=mi>5</span><span class=p>,</span><span class=w> </span><span class=mi>5</span><span class=p>,</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Rotation2d</span><span class=p>(</span><span class=mi>0</span><span class=p>)),</span>
<a id=__codelineno-4-15 name=__codelineno-4-15 href=#__codelineno-4-15></a><span class=w>    </span><span class=n>config</span>
<a id=__codelineno-4-16 name=__codelineno-4-16 href=#__codelineno-4-16></a><span class=p>);</span>
</code></pre></div> <h3 id=holomonic-controller>Holomonic Controller<a class=headerlink href=#holomonic-controller title="Permanent link">&para;</a></h3> <p>The robot's current state (position and velocity) is used by a holonomic controller object to calculate the desired chassis speeds (vx, vy, omega) needed to follow the trajectory. These speeds are then sent to the robot's drive subsystem, enabling the trajectory.</p> <p><strong>Key Steps:</strong> - The robot's current pose and velocity are passed to the holonomic controller. - The controller computes the required chassis speeds (vx, vy, omega) to achieve the desired motion. - These speeds are then sent to the robot's drive subsystem for execution.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=c1>// Example: Using a holonomic controller to follow a trajectory</span>
<a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=n>HolonomicDriveController</span><span class=w> </span><span class=n>controller</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HolonomicDriveController</span><span class=p>(</span>
<a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=w>    </span><span class=k>new</span><span class=w> </span><span class=n>PIDController</span><span class=p>(</span><span class=mf>1.0</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>),</span><span class=w>    </span><span class=c1>// X controller</span>
<a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=w>    </span><span class=k>new</span><span class=w> </span><span class=n>PIDController</span><span class=p>(</span><span class=mf>1.0</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>),</span><span class=w>    </span><span class=c1>// Y controller</span>
<a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a><span class=w>    </span><span class=k>new</span><span class=w> </span><span class=n>ProfiledPIDController</span><span class=p>(</span><span class=mf>2.0</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>TrapezoidProfile</span><span class=p>.</span><span class=na>Constraints</span><span class=p>(</span><span class=mf>3.0</span><span class=p>,</span><span class=w> </span><span class=mf>2.0</span><span class=p>))</span><span class=w> </span><span class=c1>// Rotation</span>
<a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a><span class=p>);</span>
<a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a>
<a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a><span class=nd>@Override</span>
<a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>periodic</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>isFollowingTrajectory</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a><span class=w>        </span><span class=n>Trajectory</span><span class=p>.</span><span class=na>State</span><span class=w> </span><span class=n>desiredState</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>trajectory</span><span class=p>.</span><span class=na>sample</span><span class=p>(</span><span class=n>timer</span><span class=p>.</span><span class=na>get</span><span class=p>());</span>
<a id=__codelineno-5-12 name=__codelineno-5-12 href=#__codelineno-5-12></a><span class=w>        </span><span class=n>Pose2d</span><span class=w> </span><span class=n>currentPose</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>swerve</span><span class=p>.</span><span class=na>getPose</span><span class=p>();</span>
<a id=__codelineno-5-13 name=__codelineno-5-13 href=#__codelineno-5-13></a>
<a id=__codelineno-5-14 name=__codelineno-5-14 href=#__codelineno-5-14></a><span class=w>        </span><span class=n>ChassisSpeeds</span><span class=w> </span><span class=n>speeds</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>hocontroller</span><span class=p>.</span><span class=na>calculate</span><span class=p>(</span>
<a id=__codelineno-5-15 name=__codelineno-5-15 href=#__codelineno-5-15></a><span class=w>            </span><span class=n>currentPose</span><span class=p>,</span>
<a id=__codelineno-5-16 name=__codelineno-5-16 href=#__codelineno-5-16></a><span class=w>            </span><span class=n>desiredState</span><span class=p>,</span>
<a id=__codelineno-5-17 name=__codelineno-5-17 href=#__codelineno-5-17></a><span class=w>            </span><span class=n>desiredState</span><span class=p>.</span><span class=na>poseMeters</span><span class=p>.</span><span class=na>getRotation</span><span class=p>()</span>
<a id=__codelineno-5-18 name=__codelineno-5-18 href=#__codelineno-5-18></a><span class=w>        </span><span class=p>);</span>
<a id=__codelineno-5-19 name=__codelineno-5-19 href=#__codelineno-5-19></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-5-20 name=__codelineno-5-20 href=#__codelineno-5-20></a><span class=p>}</span>
</code></pre></div> <p><strong>Reference and Further Reading</strong><br> - <a href=https://github.wpilib.org/allwpilib/docs/release/java/edu/wpi/first/math/trajectory/Trajectory.html>WPILib Trajectory Class Reference</a> - <a href=https://docs.wpilib.org/en/stable/docs/software/advanced-controls/trajectories/trajectory-generation.html>WPILib Trajectory Generation Documentation</a> - <a href=https://docs.wpilib.org/en/stable/docs/software/advanced-controls/trajectories/constraints.html>WPILib Trajectory Constraints Documentation</a></p> <hr> <h2 id=3-basic-implementation>3. Basic Implementation<a class=headerlink href=#3-basic-implementation title="Permanent link">&para;</a></h2> <p>Most teams will choose from vendors such as Pathplanner or Choreo to run their trajectory functions due to their add-on functionality. However it is recommended to first implement WPILIB trajectory. This will enable you to have access to every part of how the trajectory runs and familiarlize yourself with all the parameters available to you to adjust your trajectory. After running this iteration, it will be easier to integrate in Choreo or Pathlanner as your team chooses.</p> <p>Below is a simple implementation of WPILIB Trajectory. Follow this guide to get it working. </p> <h3 id=create-your-first-trajectory>Create Your First Trajectory<a class=headerlink href=#create-your-first-trajectory title="Permanent link">&para;</a></h3> <ol> <li>Create a custom class command that will house your trajectory following code.</li> <li>Make sure to have the following features<ul> <li>A trajectory object taken in as a parameter</li> <li>A swerve subsystem object taken in as a parameter</li> <li>Timer for tracking state of a trajectory</li> </ul> </li> <li>Constructor that completes any remaining object declarations.</li> </ol> <h3 id=define-your-holomonic-controller>Define your Holomonic Controller<a class=headerlink href=#define-your-holomonic-controller title="Permanent link">&para;</a></h3> <ol> <li>Create a holomonic controller object that is defined in the Command constructor. Use PIDController objects as parameters.</li> <li>Compartively to other PID control systems, start with int type numbers such as 1.0, 2.0, etc. </li> </ol> <h3 id=populate-execute-initialize-isfinished>Populate Execute, Initialize, isFinished<a class=headerlink href=#populate-execute-initialize-isfinished title="Permanent link">&para;</a></h3> <ol> <li><code>Intitalize</code> should contain all your reset methods for:<ul> <li>reseting odometry if it's the first path</li> <li>restarting the internal timer to match with the trajectory time</li> </ul> </li> <li> <p><code>Execute</code> should contain:</p> <ul> <li>all your trajectory state/swerve measurment readings.</li> <li>The final outputs should be a chassisspeed object that can be fed into the swerve drive.</li> </ul> </li> <li> <p><code>isFinished</code> should terminate when:</p> </li> <li>The recorded swerve measurments are in a certain deadband of the goal Pose</li> <li>When our timer exceeds the estimated time for our trajectory.</li> </ol> <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>TrajectoryCommand</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>CommandBase</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>SwerveDrive</span><span class=w> </span><span class=n>swerve</span><span class=p>;</span>
<a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Timer</span><span class=w> </span><span class=n>timer</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Timer</span><span class=p>();</span>
<a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Trajectory</span><span class=w> </span><span class=n>trajectory</span><span class=p>;</span>
<a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>HolonomicDriveController</span><span class=w> </span><span class=n>holonomicController</span><span class=p>;</span>
<a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>double</span><span class=w> </span><span class=n>POSITION_TOLERANCE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>0.10</span><span class=p>;</span><span class=w> </span><span class=c1>// meters</span>
<a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>double</span><span class=w> </span><span class=n>ROTATION_TOLERANCE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>5.0</span><span class=p>;</span><span class=w> </span><span class=c1>// degrees</span>
<a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a>
<a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>TrajectoryCommand</span><span class=p>(</span><span class=n>SwerveDrive</span><span class=w> </span><span class=n>swerve</span><span class=p>,</span><span class=w> </span><span class=n>Trajectory</span><span class=w> </span><span class=n>trajectory</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-6-10 name=__codelineno-6-10 href=#__codelineno-6-10></a><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>swerve</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>swerve</span><span class=p>;</span>
<a id=__codelineno-6-11 name=__codelineno-6-11 href=#__codelineno-6-11></a><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>trajectory</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>trajectory</span><span class=p>;</span>
<a id=__codelineno-6-12 name=__codelineno-6-12 href=#__codelineno-6-12></a>
<a id=__codelineno-6-13 name=__codelineno-6-13 href=#__codelineno-6-13></a><span class=w>        </span><span class=c1>// Holonomic controller for trajectory following</span>
<a id=__codelineno-6-14 name=__codelineno-6-14 href=#__codelineno-6-14></a><span class=w>        </span><span class=n>holonomicController</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HolonomicDriveController</span><span class=p>(</span>
<a id=__codelineno-6-15 name=__codelineno-6-15 href=#__codelineno-6-15></a><span class=w>            </span><span class=k>new</span><span class=w> </span><span class=n>PIDController</span><span class=p>(</span><span class=mf>1.0</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>),</span><span class=w>    </span><span class=c1>// X controller</span>
<a id=__codelineno-6-16 name=__codelineno-6-16 href=#__codelineno-6-16></a><span class=w>            </span><span class=k>new</span><span class=w> </span><span class=n>PIDController</span><span class=p>(</span><span class=mf>1.0</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>),</span><span class=w>    </span><span class=c1>// Y controller</span>
<a id=__codelineno-6-17 name=__codelineno-6-17 href=#__codelineno-6-17></a><span class=w>            </span><span class=k>new</span><span class=w> </span><span class=n>ProfiledPIDController</span><span class=p>(</span><span class=mf>2.0</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>TrapezoidProfile</span><span class=p>.</span><span class=na>Constraints</span><span class=p>(</span><span class=mf>3.0</span><span class=p>,</span><span class=w> </span><span class=mf>2.0</span><span class=p>))</span><span class=w> </span><span class=c1>// Rotation</span>
<a id=__codelineno-6-18 name=__codelineno-6-18 href=#__codelineno-6-18></a><span class=w>        </span><span class=p>);</span>
<a id=__codelineno-6-19 name=__codelineno-6-19 href=#__codelineno-6-19></a>
<a id=__codelineno-6-20 name=__codelineno-6-20 href=#__codelineno-6-20></a><span class=w>        </span><span class=n>addRequirements</span><span class=p>(</span><span class=n>swerve</span><span class=p>);</span>
<a id=__codelineno-6-21 name=__codelineno-6-21 href=#__codelineno-6-21></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-6-22 name=__codelineno-6-22 href=#__codelineno-6-22></a>
<a id=__codelineno-6-23 name=__codelineno-6-23 href=#__codelineno-6-23></a><span class=w>    </span><span class=nd>@Override</span>
<a id=__codelineno-6-24 name=__codelineno-6-24 href=#__codelineno-6-24></a><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>initialize</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-6-25 name=__codelineno-6-25 href=#__codelineno-6-25></a><span class=w>        </span><span class=n>timer</span><span class=p>.</span><span class=na>restart</span><span class=p>();</span>
<a id=__codelineno-6-26 name=__codelineno-6-26 href=#__codelineno-6-26></a><span class=w>        </span><span class=n>swerve</span><span class=p>.</span><span class=na>resetOdometry</span><span class=p>(</span><span class=n>trajectory</span><span class=p>.</span><span class=na>getInitialPose</span><span class=p>());</span>
<a id=__codelineno-6-27 name=__codelineno-6-27 href=#__codelineno-6-27></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-6-28 name=__codelineno-6-28 href=#__codelineno-6-28></a>
<a id=__codelineno-6-29 name=__codelineno-6-29 href=#__codelineno-6-29></a><span class=w>    </span><span class=nd>@Override</span>
<a id=__codelineno-6-30 name=__codelineno-6-30 href=#__codelineno-6-30></a><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>execute</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-6-31 name=__codelineno-6-31 href=#__codelineno-6-31></a><span class=w>        </span><span class=c1>// Get current trajectory state</span>
<a id=__codelineno-6-32 name=__codelineno-6-32 href=#__codelineno-6-32></a><span class=w>        </span><span class=n>Trajectory</span><span class=p>.</span><span class=na>State</span><span class=w> </span><span class=n>desiredState</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>trajectory</span><span class=p>.</span><span class=na>sample</span><span class=p>(</span><span class=n>timer</span><span class=p>.</span><span class=na>get</span><span class=p>());</span>
<a id=__codelineno-6-33 name=__codelineno-6-33 href=#__codelineno-6-33></a>
<a id=__codelineno-6-34 name=__codelineno-6-34 href=#__codelineno-6-34></a><span class=w>        </span><span class=c1>// Get current robot pose</span>
<a id=__codelineno-6-35 name=__codelineno-6-35 href=#__codelineno-6-35></a><span class=w>        </span><span class=n>Pose2d</span><span class=w> </span><span class=n>currentPose</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>swerve</span><span class=p>.</span><span class=na>getPose</span><span class=p>();</span>
<a id=__codelineno-6-36 name=__codelineno-6-36 href=#__codelineno-6-36></a>
<a id=__codelineno-6-37 name=__codelineno-6-37 href=#__codelineno-6-37></a><span class=w>        </span><span class=c1>// Use holonomic controller to calculate chassis speeds</span>
<a id=__codelineno-6-38 name=__codelineno-6-38 href=#__codelineno-6-38></a><span class=w>        </span><span class=n>ChassisSpeeds</span><span class=w> </span><span class=n>chassisSpeeds</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>holonomicController</span><span class=p>.</span><span class=na>calculate</span><span class=p>(</span>
<a id=__codelineno-6-39 name=__codelineno-6-39 href=#__codelineno-6-39></a><span class=w>            </span><span class=n>currentPose</span><span class=p>,</span>
<a id=__codelineno-6-40 name=__codelineno-6-40 href=#__codelineno-6-40></a><span class=w>            </span><span class=n>desiredState</span><span class=p>,</span>
<a id=__codelineno-6-41 name=__codelineno-6-41 href=#__codelineno-6-41></a><span class=w>            </span><span class=n>desiredState</span><span class=p>.</span><span class=na>poseMeters</span><span class=p>.</span><span class=na>getRotation</span><span class=p>()</span>
<a id=__codelineno-6-42 name=__codelineno-6-42 href=#__codelineno-6-42></a><span class=w>        </span><span class=p>);</span>
<a id=__codelineno-6-43 name=__codelineno-6-43 href=#__codelineno-6-43></a>
<a id=__codelineno-6-44 name=__codelineno-6-44 href=#__codelineno-6-44></a><span class=w>        </span><span class=n>swerve</span><span class=p>.</span><span class=na>drive</span><span class=p>(</span><span class=n>chassisSpeeds</span><span class=p>);</span>
<a id=__codelineno-6-45 name=__codelineno-6-45 href=#__codelineno-6-45></a>
<a id=__codelineno-6-46 name=__codelineno-6-46 href=#__codelineno-6-46></a><span class=w>        </span><span class=c1>// SmartDashboard telemetry for debugging</span>
<a id=__codelineno-6-47 name=__codelineno-6-47 href=#__codelineno-6-47></a><span class=w>        </span><span class=n>SmartDashboard</span><span class=p>.</span><span class=na>putNumber</span><span class=p>(</span><span class=s>&quot;Trajectory Time&quot;</span><span class=p>,</span><span class=w> </span><span class=n>timer</span><span class=p>.</span><span class=na>get</span><span class=p>());</span>
<a id=__codelineno-6-48 name=__codelineno-6-48 href=#__codelineno-6-48></a><span class=w>        </span><span class=n>SmartDashboard</span><span class=p>.</span><span class=na>putNumber</span><span class=p>(</span><span class=s>&quot;Desired X&quot;</span><span class=p>,</span><span class=w> </span><span class=n>desiredState</span><span class=p>.</span><span class=na>poseMeters</span><span class=p>.</span><span class=na>getX</span><span class=p>());</span>
<a id=__codelineno-6-49 name=__codelineno-6-49 href=#__codelineno-6-49></a><span class=w>        </span><span class=n>SmartDashboard</span><span class=p>.</span><span class=na>putNumber</span><span class=p>(</span><span class=s>&quot;Desired Y&quot;</span><span class=p>,</span><span class=w> </span><span class=n>desiredState</span><span class=p>.</span><span class=na>poseMeters</span><span class=p>.</span><span class=na>getY</span><span class=p>());</span>
<a id=__codelineno-6-50 name=__codelineno-6-50 href=#__codelineno-6-50></a><span class=w>        </span><span class=n>SmartDashboard</span><span class=p>.</span><span class=na>putNumber</span><span class=p>(</span><span class=s>&quot;Desired Rotation&quot;</span><span class=p>,</span><span class=w> </span><span class=n>desiredState</span><span class=p>.</span><span class=na>poseMeters</span><span class=p>.</span><span class=na>getRotation</span><span class=p>().</span><span class=na>getDegrees</span><span class=p>());</span>
<a id=__codelineno-6-51 name=__codelineno-6-51 href=#__codelineno-6-51></a><span class=w>        </span><span class=n>SmartDashboard</span><span class=p>.</span><span class=na>putNumber</span><span class=p>(</span><span class=s>&quot;Robot X&quot;</span><span class=p>,</span><span class=w> </span><span class=n>currentPose</span><span class=p>.</span><span class=na>getX</span><span class=p>());</span>
<a id=__codelineno-6-52 name=__codelineno-6-52 href=#__codelineno-6-52></a><span class=w>        </span><span class=n>SmartDashboard</span><span class=p>.</span><span class=na>putNumber</span><span class=p>(</span><span class=s>&quot;Robot Y&quot;</span><span class=p>,</span><span class=w> </span><span class=n>currentPose</span><span class=p>.</span><span class=na>getY</span><span class=p>());</span>
<a id=__codelineno-6-53 name=__codelineno-6-53 href=#__codelineno-6-53></a><span class=w>        </span><span class=n>SmartDashboard</span><span class=p>.</span><span class=na>putNumber</span><span class=p>(</span><span class=s>&quot;Robot Rotation&quot;</span><span class=p>,</span><span class=w> </span><span class=n>currentPose</span><span class=p>.</span><span class=na>getRotation</span><span class=p>().</span><span class=na>getDegrees</span><span class=p>());</span>
<a id=__codelineno-6-54 name=__codelineno-6-54 href=#__codelineno-6-54></a><span class=w>        </span><span class=n>SmartDashboard</span><span class=p>.</span><span class=na>putNumber</span><span class=p>(</span><span class=s>&quot;X Error&quot;</span><span class=p>,</span><span class=w> </span><span class=n>currentPose</span><span class=p>.</span><span class=na>getX</span><span class=p>()</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>desiredState</span><span class=p>.</span><span class=na>poseMeters</span><span class=p>.</span><span class=na>getX</span><span class=p>());</span>
<a id=__codelineno-6-55 name=__codelineno-6-55 href=#__codelineno-6-55></a><span class=w>        </span><span class=n>SmartDashboard</span><span class=p>.</span><span class=na>putNumber</span><span class=p>(</span><span class=s>&quot;Y Error&quot;</span><span class=p>,</span><span class=w> </span><span class=n>currentPose</span><span class=p>.</span><span class=na>getY</span><span class=p>()</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>desiredState</span><span class=p>.</span><span class=na>poseMeters</span><span class=p>.</span><span class=na>getY</span><span class=p>());</span>
<a id=__codelineno-6-56 name=__codelineno-6-56 href=#__codelineno-6-56></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-6-57 name=__codelineno-6-57 href=#__codelineno-6-57></a>
<a id=__codelineno-6-58 name=__codelineno-6-58 href=#__codelineno-6-58></a><span class=w>    </span><span class=nd>@Override</span>
<a id=__codelineno-6-59 name=__codelineno-6-59 href=#__codelineno-6-59></a><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>isFinished</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-6-60 name=__codelineno-6-60 href=#__codelineno-6-60></a><span class=w>        </span><span class=n>Pose2d</span><span class=w> </span><span class=n>currentPose</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>swerve</span><span class=p>.</span><span class=na>getPose</span><span class=p>();</span>
<a id=__codelineno-6-61 name=__codelineno-6-61 href=#__codelineno-6-61></a><span class=w>        </span><span class=n>Pose2d</span><span class=w> </span><span class=n>goalPose</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>trajectory</span><span class=p>.</span><span class=na>getStates</span><span class=p>().</span><span class=na>get</span><span class=p>(</span><span class=n>trajectory</span><span class=p>.</span><span class=na>getStates</span><span class=p>().</span><span class=na>size</span><span class=p>()</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>1</span><span class=p>).</span><span class=na>poseMeters</span><span class=p>;</span>
<a id=__codelineno-6-62 name=__codelineno-6-62 href=#__codelineno-6-62></a>
<a id=__codelineno-6-63 name=__codelineno-6-63 href=#__codelineno-6-63></a><span class=w>        </span><span class=kt>boolean</span><span class=w> </span><span class=n>positionClose</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>currentPose</span><span class=p>.</span><span class=na>getTranslation</span><span class=p>().</span><span class=na>getDistance</span><span class=p>(</span><span class=n>goalPose</span><span class=p>.</span><span class=na>getTranslation</span><span class=p>())</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>POSITION_TOLERANCE</span><span class=p>;</span>
<a id=__codelineno-6-64 name=__codelineno-6-64 href=#__codelineno-6-64></a><span class=w>        </span><span class=kt>boolean</span><span class=w> </span><span class=n>rotationClose</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Math</span><span class=p>.</span><span class=na>abs</span><span class=p>(</span><span class=n>currentPose</span><span class=p>.</span><span class=na>getRotation</span><span class=p>().</span><span class=na>getDegrees</span><span class=p>()</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>goalPose</span><span class=p>.</span><span class=na>getRotation</span><span class=p>().</span><span class=na>getDegrees</span><span class=p>())</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>ROTATION_TOLERANCE</span><span class=p>;</span>
<a id=__codelineno-6-65 name=__codelineno-6-65 href=#__codelineno-6-65></a>
<a id=__codelineno-6-66 name=__codelineno-6-66 href=#__codelineno-6-66></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>timer</span><span class=p>.</span><span class=na>get</span><span class=p>()</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>trajectory</span><span class=p>.</span><span class=na>getTotalTimeSeconds</span><span class=p>()</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=p>(</span><span class=n>positionClose</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>rotationClose</span><span class=p>);</span>
<a id=__codelineno-6-67 name=__codelineno-6-67 href=#__codelineno-6-67></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-6-68 name=__codelineno-6-68 href=#__codelineno-6-68></a><span class=p>}</span>
</code></pre></div> <hr> <h2 id=5-creating-autos>5. Creating Autos<a class=headerlink href=#5-creating-autos title="Permanent link">&para;</a></h2> <p>Now that we've created our first intial trajectory commands, let's fit it into an autonomous sequence.</p> <h3 id=creating-trajectories>Creating trajectories<a class=headerlink href=#creating-trajectories title="Permanent link">&para;</a></h3> <ol> <li>Create a new trajectory config with a max speed and max acceleration</li> <li>Create a trjaectory with:<ul> <li>Start and Goal Poses</li> <li>Translation2d type waypoints (Units in Meters) <div class=highlight><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=c1>//   maxSpeed: The maximum speed for the trajectory (in meters per second).</span>
<a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=c1>//   maxAcceleration: The maximum acceleration for the trajectory (in meters per second squared).</span>
<a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=n>TrajectoryConfig</span><span class=w> </span><span class=n>config</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>TrajectoryConfig</span><span class=p>(</span><span class=mf>2.0</span><span class=p>,</span><span class=w> </span><span class=mf>1.0</span><span class=p>);</span><span class=w> </span>
<a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a>
<a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a><span class=c1>// Curved path through multiple points</span>
<a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a><span class=n>Trajectory</span><span class=w> </span><span class=n>complexPath</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>TrajectoryGenerator</span><span class=p>.</span><span class=na>generateTrajectory</span><span class=p>(</span>
<a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a><span class=w>    </span><span class=k>new</span><span class=w> </span><span class=n>Pose2d</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Rotation2d</span><span class=p>(</span><span class=mi>0</span><span class=p>)),</span><span class=w>           </span><span class=c1>// Start</span>
<a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a><span class=w>    </span><span class=n>List</span><span class=p>.</span><span class=na>of</span><span class=p>(</span>
<a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a><span class=w>        </span><span class=k>new</span><span class=w> </span><span class=n>Translation2d</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>),</span><span class=w>                    </span><span class=c1>// Waypoint 1</span>
<a id=__codelineno-7-10 name=__codelineno-7-10 href=#__codelineno-7-10></a><span class=w>        </span><span class=k>new</span><span class=w> </span><span class=n>Translation2d</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=o>-</span><span class=mi>1</span><span class=p>),</span><span class=w>                   </span><span class=c1>// Waypoint 2</span>
<a id=__codelineno-7-11 name=__codelineno-7-11 href=#__codelineno-7-11></a><span class=w>        </span><span class=k>new</span><span class=w> </span><span class=n>Translation2d</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w>                     </span><span class=c1>// Waypoint 3</span>
<a id=__codelineno-7-12 name=__codelineno-7-12 href=#__codelineno-7-12></a><span class=w>    </span><span class=p>),</span>
<a id=__codelineno-7-13 name=__codelineno-7-13 href=#__codelineno-7-13></a><span class=w>    </span><span class=k>new</span><span class=w> </span><span class=n>Pose2d</span><span class=p>(</span><span class=mi>4</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Rotation2d</span><span class=p>(</span><span class=n>Math</span><span class=p>.</span><span class=na>PI</span><span class=p>)),</span><span class=w>     </span><span class=c1>// End facing backward</span>
<a id=__codelineno-7-14 name=__codelineno-7-14 href=#__codelineno-7-14></a><span class=w>    </span><span class=n>config</span>
<a id=__codelineno-7-15 name=__codelineno-7-15 href=#__codelineno-7-15></a><span class=p>);</span>
</code></pre></div></li> </ul> </li> </ol> <h3 id=optionalconstraints-for-different-sections>(Optional)Constraints for Different Sections<a class=headerlink href=#optionalconstraints-for-different-sections title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=c1>// Slower through tight areas</span>
<a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=n>TrajectoryConfig</span><span class=w> </span><span class=n>slowConfig</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>TrajectoryConfig</span><span class=p>(</span><span class=mf>1.0</span><span class=p>,</span><span class=w> </span><span class=mf>0.5</span><span class=p>);</span>
<a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=n>slowConfig</span><span class=p>.</span><span class=na>addConstraint</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>RectangularRegionConstraint</span><span class=p>(</span>
<a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a><span class=w>    </span><span class=k>new</span><span class=w> </span><span class=n>Translation2d</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=o>-</span><span class=mi>1</span><span class=p>),</span><span class=w>  </span><span class=c1>// Bottom-left corner</span>
<a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a><span class=w>    </span><span class=k>new</span><span class=w> </span><span class=n>Translation2d</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>),</span><span class=w>   </span><span class=c1>// Top-right corner  </span>
<a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a><span class=w>    </span><span class=k>new</span><span class=w> </span><span class=n>MaxVelocityConstraint</span><span class=p>(</span><span class=mf>0.5</span><span class=p>)</span><span class=w> </span><span class=c1>// Slow down in this region</span>
<a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a><span class=p>));</span>
</code></pre></div> <h3 id=apply-it-to-a-drive-trajectory-command>Apply it to a Drive Trajectory Command<a class=headerlink href=#apply-it-to-a-drive-trajectory-command title="Permanent link">&para;</a></h3> <p>Here is a full example usage as a full Command. This can be used in a chain of trajectory drive commands as shown in Real-World example below.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=c1>// Single-command autonomous routine using TrajectoryCommand</span>
<a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=kd>public</span><span class=w> </span><span class=n>Command</span><span class=w> </span><span class=nf>testPath1</span><span class=p>(</span><span class=n>SwerveDrive</span><span class=w> </span><span class=n>swerve</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=w>    </span><span class=n>TrajectoryConfig</span><span class=w> </span><span class=n>config</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>TrajectoryConfig</span><span class=p>(</span><span class=mf>2.0</span><span class=p>,</span><span class=w> </span><span class=mf>1.0</span><span class=p>);</span>
<a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a>
<a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a><span class=w>    </span><span class=n>Trajectory</span><span class=w> </span><span class=n>trajectory</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>TrajectoryGenerator</span><span class=p>.</span><span class=na>generateTrajectory</span><span class=p>(</span>
<a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a><span class=w>        </span><span class=k>new</span><span class=w> </span><span class=n>Pose2d</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Rotation2d</span><span class=p>(</span><span class=mi>0</span><span class=p>)),</span>
<a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a><span class=w>        </span><span class=n>List</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>Translation2d</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>),</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Translation2d</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span><span class=w> </span><span class=o>-</span><span class=mi>1</span><span class=p>)),</span>
<a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a><span class=w>        </span><span class=k>new</span><span class=w> </span><span class=n>Pose2d</span><span class=p>(</span><span class=mi>4</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Rotation2d</span><span class=p>(</span><span class=n>Math</span><span class=p>.</span><span class=na>PI</span><span class=p>)),</span>
<a id=__codelineno-9-9 name=__codelineno-9-9 href=#__codelineno-9-9></a><span class=w>        </span><span class=n>config</span>
<a id=__codelineno-9-10 name=__codelineno-9-10 href=#__codelineno-9-10></a><span class=w>    </span><span class=p>);</span>
<a id=__codelineno-9-11 name=__codelineno-9-11 href=#__codelineno-9-11></a>
<a id=__codelineno-9-12 name=__codelineno-9-12 href=#__codelineno-9-12></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>TrajectoryCommand</span><span class=p>(</span><span class=n>swerve</span><span class=p>,</span><span class=w> </span><span class=n>trajectory</span><span class=p>);</span>
<a id=__codelineno-9-13 name=__codelineno-9-13 href=#__codelineno-9-13></a><span class=p>}</span>
</code></pre></div> <hr> <h2 id=6-real-world-examples>6. Real-World Examples<a class=headerlink href=#6-real-world-examples title="Permanent link">&para;</a></h2> <h3 id=simple-autonomous-routine>Simple Autonomous Routine<a class=headerlink href=#simple-autonomous-routine title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>SimpleAuto</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>SequentialCommandGroup</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>SimpleAuto</span><span class=p>(</span><span class=n>SwerveDrive</span><span class=w> </span><span class=n>swerve</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class=w>        </span><span class=c1>// Trajectory config: max speed 2 m/s, max accel 1 m/s^2</span>
<a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a><span class=w>        </span><span class=n>TrajectoryConfig</span><span class=w> </span><span class=n>config</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>TrajectoryConfig</span><span class=p>(</span><span class=mf>2.0</span><span class=p>,</span><span class=w> </span><span class=mf>1.0</span><span class=p>);</span>
<a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a>
<a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a><span class=w>        </span><span class=c1>// First trajectory: leave starting position</span>
<a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a><span class=w>        </span><span class=n>Trajectory</span><span class=w> </span><span class=n>leaveTarmac</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>TrajectoryGenerator</span><span class=p>.</span><span class=na>generateTrajectory</span><span class=p>(</span>
<a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a><span class=w>            </span><span class=k>new</span><span class=w> </span><span class=n>Pose2d</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Rotation2d</span><span class=p>(</span><span class=mi>0</span><span class=p>)),</span>
<a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a><span class=w>            </span><span class=n>List</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>Translation2d</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>)),</span>
<a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a><span class=w>            </span><span class=k>new</span><span class=w> </span><span class=n>Pose2d</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Rotation2d</span><span class=p>(</span><span class=mi>0</span><span class=p>)),</span>
<a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a><span class=w>            </span><span class=n>config</span>
<a id=__codelineno-10-12 name=__codelineno-10-12 href=#__codelineno-10-12></a><span class=w>        </span><span class=p>);</span>
<a id=__codelineno-10-13 name=__codelineno-10-13 href=#__codelineno-10-13></a>
<a id=__codelineno-10-14 name=__codelineno-10-14 href=#__codelineno-10-14></a><span class=w>        </span><span class=c1>// Second trajectory: return and face backward</span>
<a id=__codelineno-10-15 name=__codelineno-10-15 href=#__codelineno-10-15></a><span class=w>        </span><span class=n>Trajectory</span><span class=w> </span><span class=n>returnToShoot</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>TrajectoryGenerator</span><span class=p>.</span><span class=na>generateTrajectory</span><span class=p>(</span>
<a id=__codelineno-10-16 name=__codelineno-10-16 href=#__codelineno-10-16></a><span class=w>            </span><span class=k>new</span><span class=w> </span><span class=n>Pose2d</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Rotation2d</span><span class=p>(</span><span class=mi>0</span><span class=p>)),</span>
<a id=__codelineno-10-17 name=__codelineno-10-17 href=#__codelineno-10-17></a><span class=w>            </span><span class=n>List</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>Translation2d</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>)),</span>
<a id=__codelineno-10-18 name=__codelineno-10-18 href=#__codelineno-10-18></a><span class=w>            </span><span class=k>new</span><span class=w> </span><span class=n>Pose2d</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Rotation2d</span><span class=p>(</span><span class=n>Math</span><span class=p>.</span><span class=na>PI</span><span class=p>)),</span>
<a id=__codelineno-10-19 name=__codelineno-10-19 href=#__codelineno-10-19></a><span class=w>            </span><span class=n>config</span>
<a id=__codelineno-10-20 name=__codelineno-10-20 href=#__codelineno-10-20></a><span class=w>        </span><span class=p>);</span>
<a id=__codelineno-10-21 name=__codelineno-10-21 href=#__codelineno-10-21></a>
<a id=__codelineno-10-22 name=__codelineno-10-22 href=#__codelineno-10-22></a><span class=w>        </span><span class=n>addCommands</span><span class=p>(</span>
<a id=__codelineno-10-23 name=__codelineno-10-23 href=#__codelineno-10-23></a><span class=w>            </span><span class=k>new</span><span class=w> </span><span class=n>TrajectoryCommand</span><span class=p>(</span><span class=n>swerve</span><span class=p>,</span><span class=w> </span><span class=n>leaveTarmac</span><span class=p>),</span>
<a id=__codelineno-10-24 name=__codelineno-10-24 href=#__codelineno-10-24></a><span class=w>            </span><span class=k>new</span><span class=w> </span><span class=n>TrajectoryCommand</span><span class=p>(</span><span class=n>swerve</span><span class=p>,</span><span class=w> </span><span class=n>returnToShoot</span><span class=p>)</span>
<a id=__codelineno-10-25 name=__codelineno-10-25 href=#__codelineno-10-25></a><span class=w>        </span><span class=p>);</span>
<a id=__codelineno-10-26 name=__codelineno-10-26 href=#__codelineno-10-26></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-10-27 name=__codelineno-10-27 href=#__codelineno-10-27></a><span class=p>}</span>
</code></pre></div> <hr> <h2 id=7-tuning-and-debugging>7. Tuning and Debugging<a class=headerlink href=#7-tuning-and-debugging title="Permanent link">&para;</a></h2> <h3 id=common-issues-solutions>Common Issues &amp; Solutions<a class=headerlink href=#common-issues-solutions title="Permanent link">&para;</a></h3> <h3 id=pid-tuning-guidelines>PID Tuning Guidelines<a class=headerlink href=#pid-tuning-guidelines title="Permanent link">&para;</a></h3> <blockquote> <p><strong>Important</strong> Make sure your swerve drive is tuned properly first before tuning your holonomic controller. See <a href=../../Chapter_4/simple_profiling/ >Chapter 4: Simple Profiling</a> for tunning a velocity controller. Tuning the holonomic controller first will lead to issues in following your trajectory properly.</p> </blockquote> <p>It's recommended to start big incrementing by ints or in 10s decimals places when tunning.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=c1>// Start with these values, adjust based on robot performance</span>
<a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=n>PIDController</span><span class=w> </span><span class=n>xController</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>PIDController</span><span class=p>(</span>
<a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a><span class=w>    </span><span class=mf>1.0</span><span class=p>,</span><span class=w>  </span><span class=c1>// P: Start here, increase if robot is slow to correct</span>
<a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a><span class=w>    </span><span class=mf>0.0</span><span class=p>,</span><span class=w>  </span><span class=c1>// I: Usually not needed for trajectory following  </span>
<a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a><span class=w>    </span><span class=mf>0.1</span><span class=w>   </span><span class=c1>// D: Add if oscillating around path</span>
<a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a><span class=p>);</span>
<a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a>
<a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a><span class=c1>// Rotation typically needs higher gains</span>
<a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a><span class=n>PIDController</span><span class=w> </span><span class=n>thetaController</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>PIDController</span><span class=p>(</span>
<a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a><span class=w>    </span><span class=mf>2.0</span><span class=p>,</span><span class=w>  </span><span class=c1>// P: Higher for rotation</span>
<a id=__codelineno-11-11 name=__codelineno-11-11 href=#__codelineno-11-11></a><span class=w>    </span><span class=mf>0.0</span><span class=p>,</span><span class=w>  </span><span class=c1>// I: Avoid unless persistent error</span>
<a id=__codelineno-11-12 name=__codelineno-11-12 href=#__codelineno-11-12></a><span class=w>    </span><span class=mf>0.0</span><span class=w>   </span><span class=c1>// D: Avoid</span>
<a id=__codelineno-11-13 name=__codelineno-11-13 href=#__codelineno-11-13></a><span class=p>);</span>
</code></pre></div> <p><strong>Problem:</strong> Robot doesn't follow path accurately<br> - <strong>Possible Fix:</strong> Tune PID controllers, check odometry calibration. Are the drive velocity controllers tuned properly?</p> <p><strong>Problem:</strong> Robot is not accurate to real world.<br> - <strong>Possible Fix:</strong> Double check field measurements, calibrate all sensors, and confirm the coordinate system matches your field setup. Even small measurement errors can accumulate and lead to noticeable trajectory inaccuracies.</p> <p><strong>Problem:</strong> Path is too aggressive/jerky<br> - <strong>Possible Fix:</strong> Lower max velocity/acceleration in TrajectoryConfig.</p> <p><strong>Problem:</strong> Robot overshoots waypoints<br> - <strong>Possible Fix:</strong> Increase derivative gains, add velocity constraints. Use SmartDashboard to check if your current pose is lagging behind your goal pose.</p> <p><strong>Problem:</strong> Rotation lags behind translation<br> - <strong>Possible Fix:</strong> Tune theta controller separately, check angular constraints.</p> <p><strong>Problem:</strong> Robot drifts off path over time<br> - <strong>Possible Fix:</strong> Improve odometry (better wheel characterization, vision correction).</p> <h3 id=success-criteria><strong>Success Criteria:</strong><a class=headerlink href=#success-criteria title="Permanent link">&para;</a></h3> <ul> <li>Robot follows planned path within 10cm accuracy</li> <li>Smooth acceleration and deceleration</li> <li>Consistent timing for autonomous coordination</li> <li>Independent rotation works smoothly</li> </ul> <hr> <h2 id=8-advanced-techniques>8. Advanced Techniques<a class=headerlink href=#8-advanced-techniques title="Permanent link">&para;</a></h2> <h3 id=dynamic-trajectory-generation>Dynamic Trajectory Generation<a class=headerlink href=#dynamic-trajectory-generation title="Permanent link">&para;</a></h3> <p>Below is a simple Drive to Pose that can be useful for games where the player needs to autonomously align with scoring or loading positions.</p> <h2 id=public-command-autotargetposeswervedrive-swerve-pose2d-target-create-new-trajectory-from-current-position-trajectory-dynamicpath-trajectorygeneratorgeneratetrajectory-swervegetpose-start-from-where-we-are-now-listof-target-go-to-new-target-config-start-following-immediately-return-new-trajectorycommandswerve-dynamicpath><div class=highlight><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=kd>public</span><span class=w> </span><span class=n>Command</span><span class=w> </span><span class=nf>autoTargetPose</span><span class=p>(</span><span class=n>SwerveDrive</span><span class=w> </span><span class=n>swerve</span><span class=p>,</span><span class=w> </span><span class=n>Pose2d</span><span class=w> </span><span class=n>target</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=w>    </span><span class=c1>// Create new trajectory from current position</span>
<a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a><span class=w>    </span><span class=n>Trajectory</span><span class=w> </span><span class=n>dynamicPath</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>TrajectoryGenerator</span><span class=p>.</span><span class=na>generateTrajectory</span><span class=p>(</span>
<a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a><span class=w>        </span><span class=n>swerve</span><span class=p>.</span><span class=na>getPose</span><span class=p>(),</span><span class=w>      </span><span class=c1>// Start from where we are now</span>
<a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a><span class=w>        </span><span class=n>List</span><span class=p>.</span><span class=na>of</span><span class=p>(),</span>
<a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a><span class=w>        </span><span class=n>target</span><span class=p>,</span><span class=w>                </span><span class=c1>// Go to new target</span>
<a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a><span class=w>        </span><span class=n>config</span>
<a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a><span class=w>    </span><span class=p>);</span>
<a id=__codelineno-12-9 name=__codelineno-12-9 href=#__codelineno-12-9></a>
<a id=__codelineno-12-10 name=__codelineno-12-10 href=#__codelineno-12-10></a><span class=w>    </span><span class=c1>// Start following immediately</span>
<a id=__codelineno-12-11 name=__codelineno-12-11 href=#__codelineno-12-11></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>TrajectoryCommand</span><span class=p>(</span><span class=n>swerve</span><span class=p>,</span><span class=w> </span><span class=n>dynamicPath</span><span class=p>)</span>
<a id=__codelineno-12-12 name=__codelineno-12-12 href=#__codelineno-12-12></a><span class=p>}</span>
</code></pre></div><a class=headerlink href=#public-command-autotargetposeswervedrive-swerve-pose2d-target-create-new-trajectory-from-current-position-trajectory-dynamicpath-trajectorygeneratorgeneratetrajectory-swervegetpose-start-from-where-we-are-now-listof-target-go-to-new-target-config-start-following-immediately-return-new-trajectorycommandswerve-dynamicpath title="Permanent link">&para;</a></h2> <h2 id=links-for-further-reference>Links for further reference<a class=headerlink href=#links-for-further-reference title="Permanent link">&para;</a></h2> <p><strong>Visual Path Planning</strong> - <a href=https://pathplanner.dev/ >PathPlanner</a> - Visual trajectory designer - <a href=https://sleipnirgroup.github.io/Choreo/ >Choreo</a> - Advanced trajectory optimization</p> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Last update"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="August 6, 2025 13:17:30 UTC">August 6, 2025</span> </span> <span class=md-source-file__fact> <span class=md-icon title=Created> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="August 6, 2025 13:17:30 UTC">August 6, 2025</span> </span> </aside> <form class=md-feedback name=feedback hidden> <fieldset> <legend class=md-feedback__title> Was this page helpful? </legend> <div class=md-feedback__inner> <div class=md-feedback__list> <button class="md-feedback__icon md-icon" type=submit title="This page was helpful" data-md-value=1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81"/></svg> </button> <button class="md-feedback__icon md-icon" type=submit title="This page could be improved" data-md-value=0> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14"/></svg> </button> </div> <div class=md-feedback__note> <div data-md-value=1 hidden> Thanks for your feedback! </div> <div data-md-value=0 hidden> Thanks for your feedback! Help us improve this page by using our <a href=... target=_blank rel=noopener>feedback form</a>. </div> </div> </div> </fieldset> </form> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["navigation.tabs", "navigation.top", "navigation.sections", "navigation.expand", "navigation.tracking"], "search": "../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../../../assets/javascripts/bundle.13a4f30d.min.js></script> <script src=https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js></script> <script src=https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/clike/clike.min.js></script> <script src=../../../js/pid-simulator.js></script> </body> </html>